var COUNTER=0,INTERVAL=null;INTERVAL=setInterval(function(){if(window.scrollTo(0,document.body.scrollHeight),++COUNTER%5==0){if(window.g_logger)return;showStatusWindow(),determinePageType(),setUpActions(),doActions(0)}100===COUNTER&&clearInterval(INTERVAL)},2e3);var todo=15,EXPAND_POST=1,EXPAND_COMMENTS=2,EXPAND_REPLIES=4,EXPAND_XLAT=8,WAIT_TIME=200,MAX_WAIT=10,END_DELAY=2.5,CSS_COMMENT_AREA="UFIList",ATTR_SHOW_COMMENT_AREA="data-comment-prelude-ref",CSS_SHOW_COMMENT_AREA="UFIBlingBox",CSS_SHOW_COMMENT_AREA_2="uiBlingBox",_NONE="no-value",_COMMENTS="-comments",_REPLIES="-replies",CSS_CONTINUE_READING="text_exposed_link",CSS_PAGER="UFIPagerLink",CSS_LINK_TEXT="UFIReplySocialSentenceLinkText",CSS_SEE_MORE="fss",CSS_GROUPS_SIDE_MARGIN="groupsSideMargin",CSS_COMMENT="UFIComment",CSS_REPLY_LIST="UFIReplyList",CSS_XLAT_POST="_43f9",CSS_XLAT_COMMENT="UFITranslateLink",CSS_XLATED="UFITranslatedText",CSS_LOGIN_OVERLAY="_5hn6",CSS_LOGIN_DIALOG="generic_dialog_modal",CSS_PERMALINK="permalinkPost";function escapeClauseOn(){window.abortNow=!1,document.addEventListener("keyup",docKeyUp)}function escapeClauseOff(){window.abortNow=!0,document.removeEventListener("keyup",docKeyUp)}function docKeyUp(e){27==e.keyCode&&(myLog("Aborting..."),window.abortNow=!0)}function showStatusWindow(){var e=document.getElementsByTagName("html")[0],n=e.clientWidth,t=e.clientHeight,o=0;n>300&&(o=(n-300)/2);var i=0;t>200&&(i=(t-200)/3);var s=document.createElement("div");s.id="status-window",s.style.position="fixed",s.style.zIndex="999999",s.style.left=o+"px",s.style.width="300px",s.style.top=i+"px",s.style.height="200px";var l=document.body;l.insertBefore(s,l.firstChild);var a=document.createElement("textarea");a.style.width="100%",a.style.height="100%",a.style.color="#fff",a.style.backgroundColor="#425f9c",s.appendChild(a),window.g_logger=a,escapeClauseOn()}function hideStatusWindow(){var e=document.getElementById("status-window");document.body.removeChild(e),g_logger=null,escapeClauseOff()}function myLog(e){console.log(e),window.g_logger.value=e+"\n"+window.g_logger.value}function endSession(){window.timeouts>0&&myLog(window.timeouts+" timeout(s)"),myLog("Number of comments and replies = "+window.g_rootNode.getElementsByClassName(CSS_COMMENT).length),window.setTimeout(hideStatusWindow,1e3*END_DELAY)}function determinePageType(){window.g_rootNode=document;var e=document.getElementsByClassName(CSS_PERMALINK);1===e.length&&(myLog("Expanding permalinked post only"),window.g_rootNode=e[0])}function getDomSize(){return window.g_rootNode.getElementsByTagName("*").length}function getStyle(e){return e.ownerDocument.defaultView.getComputedStyle(e,null)}function isHidden(e){return"none"==getStyle(e).display}function hasClassName(e,n){var t=e.className.indexOf(n);if(t<0)return!1;var o=e.className.length-n.length;return 0===o||(0===t?0===e.className.indexOf(n+" "):t===o?e.className.indexOf(" "+n)===o-1:hasClassName(e," "+n+" "))}function getAncestorByType(e,n,t){for(;e;)if((e=e.parentNode)&&e.nodeName==n)return e;return t}function getAncestorByClass(e,n){for(;e;)if((e=e.parentNode)&&e.className&&hasClassName(e,n))return e;return null}function deleteOverlay(){var e=document.getElementsByClassName(CSS_LOGIN_OVERLAY);1===e.length&&(myLog("Removing Sign Up overlay"),e[0].parentNode.removeChild(e[0])),1===(e=document.getElementsByClassName(CSS_LOGIN_DIALOG)).length&&(myLog("Removing login dialog"),e[0].parentNode.removeChild(e[0]))}function ensureCommentsShowing(e,n){for(var t=null!=e,o=t?window.g_rootNode.getElementsByClassName(e):window.g_rootNode.getElementsByTagName("A"),i=[],s=0;s<o.length;s++){if(t||o[s].getAttribute(ATTR_SHOW_COMMENT_AREA))0==getAncestorByType(o[s],"FORM",document).getElementsByClassName(CSS_COMMENT_AREA).length&&i.push(o[s])}i.length>0?(myLog("Showing comments for "+i.length+" post(s)"),clickAndWait(_NONE,n,i,0)):n&&n()}function isHideReplies(e){return!(!hasClassName(e,CSS_LINK_TEXT)||1!==e.children.length)&&isNaN(window.parseInt(e.textContent,10))}function newWindow(e){var n=e.getElementsByTagName("A");if(n.length>0){var t=n[0].getAttribute("target");if(t)return myLog("New window: "+n[0].textContent),window.open(n[0].getAttribute("href"),t)||myLog("New window was blocked!"),!0}return!1}function clickClass(e,n){if(window.abortNow)n&&n();else{for(var t=window.g_rootNode.getElementsByClassName(e),o=[],i=0;i<t.length;i++)if(e!==CSS_CONTINUE_READING)if(e!==CSS_XLAT_POST)if(e!==CSS_XLAT_COMMENT)if(isHideReplies(t[i]));else{if(e===CSS_SEE_MORE&&"SPAN"===t[i].nodeName)continue;newWindow(t[i])||o.push(t[i])}else getAncestorByClass(t[i],CSS_XLATED)||o.push(t[i]);else t[i].children.length>0&&"A"===t[i].children[0].nodeName&&o.push(t[i].children[0]);else{if(getAncestorByClass(t[i],CSS_GROUPS_SIDE_MARGIN))continue;!isHidden(t[i])&&t[i].children.length>0&&o.push(t[i].children[0])}o.length>0?clickAndWait(e,n,o,0):n&&n()}}function commentsOrReplies(e,n){if(window.abortNow)n&&n();else{for(var t=window.g_rootNode.getElementsByClassName(CSS_PAGER),o=[],i=0;i<t.length;i++){var s=null!=getAncestorByClass(t[i],CSS_REPLY_LIST);e&&!s?o.push(t[i]):!e&&s&&o.push(t[i])}o.length>0?clickAndWait(e?_COMMENTS:_REPLIES,n,o,0):n&&n()}}function clickAndWait(e,n,t,o){if(window.abortNow)n&&n();else{var i=t[o].getAttribute("aria-label");i||(i=t[o].textContent),myLog("click ("+(t.length-o-1)+" left): "+i),window.domChanged=!0,t[o].click();var s=getDomSize()+(e===_NONE?20:0),l=e===CSS_SEE_MORE?0:MAX_WAIT;window.setTimeout(function(){waitHelper(e,n,t,o,s,l)},WAIT_TIME)}}function waitHelper(e,n,t,o,i,s){0===s||getDomSize()>i?++o<t.length?clickAndWait(e,n,t,o):s>0?e==_COMMENTS||e==_REPLIES?commentsOrReplies(e==_COMMENTS,n):clickClass(e,n):(window.timeouts++,n&&n()):window.setTimeout(function(){waitHelper(e,n,t,o,i,--s)},WAIT_TIME)}function setUpActions(){var e=window.actions=[];e.push(function(e){ensureCommentsShowing(null,e)}),e.push(function(e){ensureCommentsShowing(CSS_SHOW_COMMENT_AREA,e)}),e.push(function(e){ensureCommentsShowing(CSS_SHOW_COMMENT_AREA_2,e)}),0!=(todo&EXPAND_POST)&&e.push(function(e){clickClass(CSS_CONTINUE_READING,e)}),0!=(todo&EXPAND_COMMENTS)&&e.push(function(e){commentsOrReplies(!0,e)}),0!=(todo&EXPAND_REPLIES)&&(e.push(function(e){clickClass(CSS_LINK_TEXT,e)}),e.push(function(e){commentsOrReplies(!1,e)})),e.push(function(e){clickClass(CSS_SEE_MORE,e)}),0!=(todo&EXPAND_XLAT)&&(e.push(function(e){clickClass(CSS_XLAT_POST,e)}),e.push(function(e){clickClass(CSS_XLAT_COMMENT,e)})),e.push(function(e){window.setTimeout(endSession,window.domChanged?WAIT_TIME:0)}),e.push(null),window.timeouts=0,window.domChanged=!1}function doActions(e){deleteOverlay(),null!=window.actions[e]&&window.actions[e](function(){doActions(e+1)})}